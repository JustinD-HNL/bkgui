<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buildkite Pipeline Builder</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Firebase SDK - Using consistent version 9.22.2 -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
</head>
<body>
    <!-- Authentication Container -->
    <div id="auth-container" class="auth-container">
        <div class="auth-modal">
            <div class="auth-header">
                <h1>üèóÔ∏è Buildkite Pipeline Builder</h1>
                <p>Sign in to start building your pipelines</p>
            </div>

            <div class="auth-content">
                <!-- Google Sign-In -->
                <button id="google-signin-btn" class="google-btn">
                    <svg class="google-icon" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    <span>Continue with Google</span>
                </button>

                <!-- Loading Spinner -->
                <div id="auth-loading" class="loading-spinner" style="display: none;">
                    <div class="spinner"></div>
                    <p>Signing you in...</p>
                </div>

                <!-- Error Message -->
                <div id="auth-error" class="error-message" style="display: none;"></div>

                <!-- Success Message -->
                <div id="auth-success" class="success-message" style="display: none;"></div>

                <!-- Debug Info (only shown when there are config issues) -->
                <div id="auth-debug" class="debug-info" style="display: none;">
                    <details>
                        <summary>Debug Information</summary>
                        <div id="debug-details"></div>
                    </details>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application (hidden until authenticated) -->
    <div id="main-app" class="main-app" style="display: none;">
        <div class="app-container">
            <!-- Header -->
            <header class="header">
                <div class="header-content">
                    <h1><i class="fas fa-sitemap"></i> Buildkite Pipeline Builder</h1>
                    <div class="header-actions">
                        <div id="user-info" class="user-info">
                            <img id="user-avatar" class="user-avatar" alt="User Avatar" style="display: none;">
                            <span id="user-email"></span>
                            <button class="btn btn-outline" onclick="firebaseAuth.signOut()">Sign Out</button>
                        </div>
                        <button id="clear-pipeline" class="btn btn-secondary">
                            <i class="fas fa-trash"></i> Clear
                        </button>
                        <button id="load-example" class="btn btn-secondary">
                            <i class="fas fa-download"></i> Load Example
                        </button>
                        <button id="export-yaml" class="btn btn-primary">
                            <i class="fas fa-file-export"></i> Export YAML
                        </button>
                    </div>
                </div>
            </header>

            <div class="main-content">
                <!-- Sidebar with Step Types -->
                <aside class="sidebar">
                    <h3><i class="fas fa-puzzle-piece"></i> Step Types</h3>
                    <div class="step-palette">
                        <div class="step-type" draggable="true" data-step-type="command">
                            <i class="fas fa-terminal"></i>
                            <span>Command Step</span>
                            <small>Execute commands/scripts</small>
                        </div>
                        <div class="step-type" draggable="true" data-step-type="wait">
                            <i class="fas fa-hourglass-half"></i>
                            <span>Wait Step</span>
                            <small>Wait for dependencies</small>
                        </div>
                        <div class="step-type" draggable="true" data-step-type="block">
                            <i class="fas fa-hand-paper"></i>
                            <span>Block Step</span>
                            <small>Manual approval</small>
                        </div>
                        <div class="step-type" draggable="true" data-step-type="input">
                            <i class="fas fa-keyboard"></i>
                            <span>Input Step</span>
                            <small>Collect user input</small>
                        </div>
                        <div class="step-type" draggable="true" data-step-type="trigger">
                            <i class="fas fa-play"></i>
                            <span>Trigger Step</span>
                            <small>Trigger other pipelines</small>
                        </div>
                        <div class="step-type" draggable="true" data-step-type="group">
                            <i class="fas fa-layer-group"></i>
                            <span>Group Step</span>
                            <small>Group related steps</small>
                        </div>
                    </div>
                </aside>

                <!-- Pipeline Canvas -->
                <main class="pipeline-canvas">
                    <div class="canvas-header">
                        <h3><i class="fas fa-project-diagram"></i> Pipeline Canvas</h3>
                        <span class="canvas-hint">Drag step types from the sidebar to build your pipeline</span>
                    </div>
                    <div id="pipeline-steps" class="pipeline-steps">
                        <div class="drop-zone" data-drop-index="0">
                            <i class="fas fa-plus-circle"></i>
                            <span>Drop steps here to start building your pipeline</span>
                        </div>
                    </div>
                </main>

                <!-- Properties Panel -->
                <aside class="properties-panel">
                    <h3><i class="fas fa-cog"></i> Properties</h3>
                    <div id="step-properties" class="step-properties">
                        <div class="no-selection">
                            <i class="fas fa-mouse-pointer"></i>
                            <p>Select a step to edit its properties</p>
                        </div>
                    </div>
                </aside>
            </div>

            <!-- YAML Export Modal -->
            <div id="yaml-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-file-code"></i> Generated Pipeline YAML</h3>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-body">
                        <textarea id="yaml-output" readonly></textarea>
                        <div class="modal-actions">
                            <button id="copy-yaml" class="btn btn-primary">
                                <i class="fas fa-copy"></i> Copy to Clipboard
                            </button>
                            <button id="download-yaml" class="btn btn-secondary">
                                <i class="fas fa-download"></i> Download File
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts - Load in correct order -->
    <script src="js/firebase-auth.js"></script>
    <script src="js/yaml-generator.js"></script>
    <script src="js/pipeline-builder.js"></script>
    <script src="js/app.js"></script>

    <script>
        // Initialize authentication when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Set up Google Sign-In button
            const googleBtn = document.getElementById('google-signin-btn');
            if (googleBtn) {
                googleBtn.addEventListener('click', async function(e) {
                    e.preventDefault();
                    if (window.firebaseAuth) {
                        await firebaseAuth.signInWithGoogle();
                    } else {
                        console.error('Firebase Auth not initialized');
                    }
                });
            }
        });
    </script>
</body>
</html>