<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buildkite Pipeline Builder</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Main Application -->
    <div id="app-container" class="app-container">
        <!-- Header - FIXED: Title now properly positioned at top -->
        <header class="header">
            <div class="header-content">
                <div class="header-brand">
                    <i class="fas fa-stream"></i>
                    <h1>Buildkite Pipeline Builder</h1>
                    <span class="version">Enhanced v2.0</span>
                </div>
                <div class="header-actions">
                    <button id="load-example" class="btn btn-secondary">
                        <i class="fas fa-file-import"></i>
                        Load Example
                    </button>
                    <button id="clear-pipeline" class="btn btn-secondary">
                        <i class="fas fa-trash"></i>
                        Clear All
                    </button>
                    <button id="export-yaml" class="btn btn-primary">
                        <i class="fas fa-download"></i>
                        Export YAML
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content - 3 Column Layout - FIXED: Proper grid structure -->
        <main class="main-content">
            <!-- Enhanced Sidebar - Left Column -->
            <aside class="sidebar enhanced-sidebar">
                <div class="sidebar-header">
                    <h3><i class="fas fa-toolbox"></i> Step Types</h3>
                    <p>Drag steps to build your pipeline</p>
                </div>

                <!-- Core Steps -->
                <div class="step-category">
                    <h4><i class="fas fa-star"></i> Core Steps</h4>
                    <div class="step-palette">
                        <div class="step-type" draggable="true" data-step-type="command">
                            <i class="fas fa-terminal"></i>
                            <span>Command Step</span>
                            <small>Execute shell commands</small>
                        </div>
                        <div class="step-type" draggable="true" data-step-type="wait">
                            <i class="fas fa-hourglass-half"></i>
                            <span>Wait Step</span>
                            <small>Wait for previous steps</small>
                        </div>
                        <div class="step-type" draggable="true" data-step-type="block">
                            <i class="fas fa-hand-paper"></i>
                            <span>Block Step</span>
                            <small>Manual approval gate</small>
                        </div>
                        <div class="step-type" draggable="true" data-step-type="input">
                            <i class="fas fa-keyboard"></i>
                            <span>Input Step</span>
                            <small>Collect user input</small>
                        </div>
                        <div class="step-type" draggable="true" data-step-type="trigger">
                            <i class="fas fa-bolt"></i>
                            <span>Trigger Step</span>
                            <small>Trigger another pipeline</small>
                        </div>
                        <div class="step-type" draggable="true" data-step-type="group">
                            <i class="fas fa-layer-group"></i>
                            <span>Group Step</span>
                            <small>Group multiple steps</small>
                        </div>
                    </div>
                </div>

                <!-- Advanced Steps -->
                <div class="step-category">
                    <h4><i class="fas fa-tools"></i> Advanced</h4>
                    <div class="step-palette">
                        <div class="step-type" draggable="true" data-step-type="pipeline-upload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <span>Pipeline Upload</span>
                            <small>Upload dynamic pipeline</small>
                        </div>
                    </div>
                </div>

                <!-- Sidebar Actions -->
                <div class="sidebar-actions">
                    <!-- Quick Actions Grid -->
                    <div class="quick-actions">
                        <button class="action-btn" data-action="plugin-catalog">
                            <i class="fas fa-store"></i>
                            <span>Plugin Catalog</span>
                        </button>
                        <button class="action-btn" data-action="matrix-builder">
                            <i class="fas fa-th"></i>
                            <span>Matrix Builder</span>
                        </button>
                        <button class="action-btn" data-action="step-templates">
                            <i class="fas fa-file-alt"></i>
                            <span>Step Templates</span>
                        </button>
                        <button class="action-btn" data-action="dependency-manager">
                            <i class="fas fa-sitemap"></i>
                            <span>Dependencies</span>
                        </button>
                    </div>

                    <!-- Plugin Quickstart -->
                    <div class="plugin-quickstart">
                        <div class="plugin-quick" data-plugin="docker">
                            <i class="fab fa-docker"></i>
                            <span>Docker</span>
                        </div>
                        <div class="plugin-quick" data-plugin="artifacts">
                            <i class="fas fa-archive"></i>
                            <span>Artifacts</span>
                        </div>
                        <div class="plugin-quick" data-plugin="ecr">
                            <i class="fab fa-aws"></i>
                            <span>AWS ECR</span>
                        </div>
                        <div class="plugin-quick" data-plugin="slack">
                            <i class="fab fa-slack"></i>
                            <span>Slack</span>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Pipeline Canvas - Center Column - FIXED: Proper drop zone structure -->
            <section class="pipeline-canvas">
                <div class="canvas-header">
                    <h2><i class="fas fa-stream"></i> Pipeline Steps</h2>
                    <div class="canvas-actions">
                        <button id="validate-pipeline" class="btn btn-secondary">
                            <i class="fas fa-check-circle"></i>
                            Validate
                        </button>
                        <button class="btn btn-outline" data-action="pipeline-validator">
                            <i class="fas fa-clipboard-check"></i>
                            Advanced Validation
                        </button>
                    </div>
                </div>

                <!-- Drop Zone for Pipeline Steps -->
                <div id="pipeline-steps" class="pipeline-steps">
                    <!-- Steps will be rendered here -->
                    <div class="empty-pipeline">
                        <div class="empty-content">
                            <i class="fas fa-hand-paper"></i>
                            <h3>Start Building Your Pipeline</h3>
                            <p>Drag step types from the sidebar to create your pipeline</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Properties Panel - Right Column -->
            <aside class="properties-panel">
                <div class="properties-header">
                    <h3><i class="fas fa-cog"></i> Properties</h3>
                    <span class="step-count">0 steps</span>
                </div>
                
                <div id="properties-content" class="properties-content">
                    <p class="no-selection">Select a step to view its properties</p>
                </div>
            </aside>
        </main>

        <!-- YAML Output Panel -->
        <section class="yaml-output-panel">
            <div class="yaml-header">
                <h3><i class="fas fa-file-code"></i> YAML Output</h3>
                <div class="yaml-actions">
                    <button id="validate-yaml" class="btn btn-outline">
                        <i class="fas fa-check"></i>
                        Validate
                    </button>
                    <button id="download-yaml" class="btn btn-secondary">
                        <i class="fas fa-download"></i>
                        Download
                    </button>
                </div>
            </div>
            
            <div class="yaml-content">
                <textarea id="yaml-output" placeholder="YAML will appear here when you build your pipeline..."></textarea>
                
                <div id="yaml-validation" class="yaml-validation hidden">
                    <div id="validation-content"></div>
                </div>
            </div>
        </section>
    </div>

    <!-- Command Palette -->
    <div id="command-palette" class="command-palette hidden">
        <div class="command-palette-content">
            <div class="command-palette-header">
                <i class="fas fa-search"></i>
                <input type="text" class="command-palette-input" placeholder="Search commands..." />
                <button class="command-palette-close">&times;</button>
            </div>
            <div class="command-palette-results">
                <!-- Results will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- All Modals - COMPLETE -->
    
    <!-- Plugin Catalog Modal -->
    <div id="plugin-catalog-modal" class="modal hidden">
        <div class="modal-content large">
            <div class="modal-header">
                <h3><i class="fas fa-store"></i> Plugin Catalog</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="plugin-search">
                    <input type="text" placeholder="Search plugins..." class="plugin-search-input">
                    <div class="plugin-filters">
                        <button class="filter-btn active" data-filter="all">All</button>
                        <button class="filter-btn" data-filter="testing">Testing</button>
                        <button class="filter-btn" data-filter="deployment">Deployment</button>
                        <button class="filter-btn" data-filter="notification">Notification</button>
                        <button class="filter-btn" data-filter="security">Security</button>
                    </div>
                </div>
                <div id="plugin-catalog-content" class="plugin-catalog">
                    <!-- Plugin cards will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Matrix Builder Modal -->
    <div id="matrix-builder-modal" class="modal hidden">
        <div class="modal-content large">
            <div class="modal-header">
                <h3><i class="fas fa-th"></i> Matrix Build Configuration</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="matrix-builder">
                    <div class="matrix-dimensions">
                        <h4>Matrix Dimensions</h4>
                        <div id="matrix-dimensions-list">
                            <!-- Dynamic dimensions will be added here -->
                        </div>
                        <button class="btn btn-secondary" id="add-matrix-dimension">
                            <i class="fas fa-plus"></i> Add Dimension
                        </button>
                    </div>
                    
                    <div class="matrix-preview">
                        <h4>Generated Jobs Preview</h4>
                        <div id="matrix-jobs-preview">
                            <p class="no-matrix">Add dimensions to see job combinations</p>
                        </div>
                    </div>
                    
                    <div class="matrix-config">
                        <h4>Matrix Configuration</h4>
                        <div class="property-group">
                            <label for="matrix-strategy">Execution Strategy</label>
                            <select id="matrix-strategy">
                                <option value="eager">Eager - Start all jobs immediately</option>
                                <option value="conservative">Conservative - Start jobs as resources available</option>
                                <option value="fail-fast">Fail Fast - Stop on first failure</option>
                            </select>
                        </div>
                        
                        <div class="property-group">
                            <label for="matrix-max-parallel">Max Parallel Jobs</label>
                            <input type="number" id="matrix-max-parallel" value="10" min="1" max="50">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">Cancel</button>
                <button class="btn btn-primary" id="apply-matrix">Apply Matrix</button>
            </div>
        </div>
    </div>

    <!-- Step Templates Modal -->
    <div id="step-templates-modal" class="modal hidden">
        <div class="modal-content large">
            <div class="modal-header">
                <h3><i class="fas fa-file-alt"></i> Step Templates</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="template-categories">
                    <div class="template-category">
                        <h4><i class="fas fa-vial"></i> Testing</h4>
                        <div class="template-grid">
                            <div class="template-item" data-template="unit-tests">
                                <h5>Unit Tests</h5>
                                <p>Run unit tests with coverage reporting</p>
                                <div class="template-tags">
                                    <span class="tag">Jest</span>
                                    <span class="tag">Coverage</span>
                                </div>
                            </div>
                            <div class="template-item" data-template="integration-tests">
                                <h5>Integration Tests</h5>
                                <p>End-to-end integration testing</p>
                                <div class="template-tags">
                                    <span class="tag">Cypress</span>
                                    <span class="tag">E2E</span>
                                </div>
                            </div>
                            <div class="template-item" data-template="security-scan">
                                <h5>Security Scan</h5>
                                <p>Code security vulnerability scanning</p>
                                <div class="template-tags">
                                    <span class="tag">Security</span>
                                    <span class="tag">SAST</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="template-category">
                        <h4><i class="fas fa-tools"></i> Build & Package</h4>
                        <div class="template-grid">
                            <div class="template-item" data-template="docker-build">
                                <h5>Docker Build</h5>
                                <p>Build and push Docker images</p>
                                <div class="template-tags">
                                    <span class="tag">Docker</span>
                                    <span class="tag">Registry</span>
                                </div>
                            </div>
                            <div class="template-item" data-template="npm-package">
                                <h5>NPM Package</h5>
                                <p>Build and publish NPM packages</p>
                                <div class="template-tags">
                                    <span class="tag">Node.js</span>
                                    <span class="tag">NPM</span>
                                </div>
                            </div>
                            <div class="template-item" data-template="artifact-upload">
                                <h5>Artifact Upload</h5>
                                <p>Upload build artifacts for distribution</p>
                                <div class="template-tags">
                                    <span class="tag">Artifacts</span>
                                    <span class="tag">Storage</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="template-category">
                        <h4><i class="fas fa-rocket"></i> Deployment</h4>
                        <div class="template-grid">
                            <div class="template-item" data-template="k8s-deploy">
                                <h5>Kubernetes Deploy</h5>
                                <p>Deploy to Kubernetes cluster</p>
                                <div class="template-tags">
                                    <span class="tag">Kubernetes</span>
                                    <span class="tag">Deploy</span>
                                </div>
                            </div>
                            <div class="template-item" data-template="aws-deploy">
                                <h5>AWS Deploy</h5>
                                <p>Deploy to AWS services</p>
                                <div class="template-tags">
                                    <span class="tag">AWS</span>
                                    <span class="tag">Cloud</span>
                                </div>
                            </div>
                            <div class="template-item" data-template="static-deploy">
                                <h5>Static Site Deploy</h5>
                                <p>Deploy static websites</p>
                                <div class="template-tags">
                                    <span class="tag">Static</span>
                                    <span class="tag">CDN</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dependency Manager Modal -->
    <div id="dependency-manager-modal" class="modal hidden">
        <div class="modal-content large">
            <div class="modal-header">
                <h3><i class="fas fa-sitemap"></i> Dependency Manager</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="dependency-manager">
                    <div class="dependency-types">
                        <h4>Dependency Types</h4>
                        <div class="dependency-type-buttons">
                            <button class="btn btn-outline dependency-type-btn active" data-type="explicit">
                                <i class="fas fa-link"></i> Explicit Dependencies
                            </button>
                            <button class="btn btn-outline dependency-type-btn" data-type="file-based">
                                <i class="fas fa-file"></i> File-Based Dependencies
                            </button>
                            <button class="btn btn-outline dependency-type-btn" data-type="conditional">
                                <i class="fas fa-code-branch"></i> Conditional Dependencies
                            </button>
                        </div>
                    </div>
                    
                    <div class="dependency-content">
                        <div id="explicit-dependencies" class="dependency-section">
                            <div class="step-dependencies">
                                <h5>Step Dependencies</h5>
                                <div id="step-dependency-list">
                                    <!-- Dynamic step dependency UI will be populated here -->
                                </div>
                                <button class="btn btn-secondary" id="add-dependency">
                                    <i class="fas fa-plus"></i> Add Dependency
                                </button>
                            </div>
                        </div>
                        
                        <div id="file-based-dependencies" class="dependency-section" style="display: none;">
                            <div class="file-dependency-builder">
                                <h5>File Change Dependencies</h5>
                                <div class="file-patterns">
                                    <div class="property-group">
                                        <label>Watch Patterns</label>
                                        <textarea placeholder="src/**/*.js&#10;tests/**/*.test.js&#10;package.json"></textarea>
                                        <small>File patterns that trigger this step when changed</small>
                                    </div>
                                    <div class="property-group">
                                        <label>Ignore Patterns</label>
                                        <textarea placeholder="node_modules/**&#10;*.log&#10;.git/**"></textarea>
                                        <small>File patterns to ignore</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="conditional-dependencies" class="dependency-section" style="display: none;">
                            <div class="conditional-dependency-builder">
                                <h5>Conditional Dependencies</h5>
                                <div class="condition-builder">
                                    <div class="condition-group">
                                        <div class="condition-header">
                                            <h4>IF Conditions</h4>
                                            <button class="btn btn-secondary btn-small" data-action="add-condition" data-type="if">
                                                <i class="fas fa-plus"></i> Add Condition
                                            </button>
                                        </div>
                                        <div id="if-conditions" class="conditions-list">
                                            <!-- Dynamic conditions will be added here -->
                                        </div>
                                    </div>
                                    
                                    <div class="condition-group">
                                        <div class="condition-header">
                                            <h4>UNLESS Conditions</h4>
                                            <button class="btn btn-secondary btn-small" data-action="add-condition" data-type="unless">
                                                <i class="fas fa-plus"></i> Add Condition
                                            </button>
                                        </div>
                                        <div id="unless-conditions" class="conditions-list">
                                            <!-- Dynamic conditions will be added here -->
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="condition-preview">
                                    <h4>Generated Condition</h4>
                                    <pre id="condition-output">No conditions defined</pre>
                                </div>
                                
                                <div class="condition-templates">
                                    <h4>Quick Templates</h4>
                                    <div class="template-buttons">
                                        <button class="btn btn-outline" data-template="main-branch">
                                            Main Branch Only
                                        </button>
                                        <button class="btn btn-outline" data-template="pull-request">
                                            Pull Request Only
                                        </button>
                                        <button class="btn btn-outline" data-template="file-changes">
                                            File Changes
                                        </button>
                                        <button class="btn btn-outline" data-template="env-var">
                                            Environment Variable
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">Cancel</button>
                <button class="btn btn-primary" id="apply-dependencies">Apply Dependencies</button>
            </div>
        </div>
    </div>

    <!-- Dependency Graph Modal -->
    <div id="dependency-graph-modal" class="modal hidden">
        <div class="modal-content large">
            <div class="modal-header">
                <h3><i class="fas fa-project-diagram"></i> Pipeline Dependency Graph</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="graph-controls">
                    <button class="btn btn-secondary" data-action="reset-view">
                        <i class="fas fa-expand-arrows-alt"></i> Reset View
                    </button>
                    <button class="btn btn-secondary" data-action="auto-layout">
                        <i class="fas fa-magic"></i> Auto Layout
                    </button>
                    <button class="btn btn-secondary" data-action="export-graph">
                        <i class="fas fa-download"></i> Export SVG
                    </button>
                    <div class="graph-legend">
                        <span class="legend-item">
                            <div class="legend-color" style="background: #667eea;"></div>
                            Command Steps
                        </span>
                        <span class="legend-item">
                            <div class="legend-color" style="background: #f6ad55;"></div>
                            Wait Steps
                        </span>
                        <span class="legend-item">
                            <div class="legend-color" style="background: #e53e3e;"></div>
                            Block Steps
                        </span>
                    </div>
                </div>
                <div class="dependency-graph-canvas">
                    <canvas id="dependency-canvas" width="800" height="600"></canvas>
                </div>
                <div class="graph-info">
                    <div id="node-details" class="node-details">
                        <h4>Select a step to view details</h4>
                        <p>Click on any step in the graph to see its configuration and dependencies.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Conditional Builder Modal -->
    <div id="conditional-builder-modal" class="modal hidden">
        <div class="modal-content large">
            <div class="modal-header">
                <h3><i class="fas fa-code-branch"></i> Conditional Logic Builder</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="conditional-builder">
                    <div class="condition-groups" id="condition-groups">
                        <div class="condition-group">
                            <div class="condition-header">
                                <h4>IF Conditions</h4>
                                <button class="btn btn-secondary btn-small" data-action="add-condition" data-type="if">
                                    <i class="fas fa-plus"></i> Add Condition
                                </button>
                            </div>
                            <div id="if-conditions" class="conditions-list">
                                <!-- Dynamic conditions will be added here -->
                            </div>
                        </div>
                        
                        <div class="condition-group">
                            <div class="condition-header">
                                <h4>UNLESS Conditions</h4>
                                <button class="btn btn-secondary btn-small" data-action="add-condition" data-type="unless">
                                    <i class="fas fa-plus"></i> Add Condition
                                </button>
                            </div>
                            <div id="unless-conditions" class="conditions-list">
                                <!-- Dynamic conditions will be added here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="condition-preview">
                        <h4>Generated Condition</h4>
                        <pre id="condition-output">No conditions defined</pre>
                        <div class="condition-explanation">
                            <h5>How it works:</h5>
                            <ul>
                                <li><strong>IF</strong> conditions must ALL be true for the step to run</li>
                                <li><strong>UNLESS</strong> conditions must ALL be false for the step to run</li>
                                <li>Use logical operators (&&, ||) to combine conditions</li>
                                <li>Access build metadata with <code>build.branch</code>, <code>build.tag</code>, etc.</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="condition-templates">
                        <h4>Quick Templates</h4>
                        <div class="template-buttons">
                            <button class="btn btn-outline" data-template="main-branch">
                                <i class="fas fa-code-branch"></i>
                                Main Branch Only
                            </button>
                            <button class="btn btn-outline" data-template="pull-request">
                                <i class="fas fa-code-pull-request"></i>
                                Pull Request Only
                            </button>
                            <button class="btn btn-outline" data-template="tag-release">
                                <i class="fas fa-tag"></i>
                                Tagged Release
                            </button>
                            <button class="btn btn-outline" data-template="file-changes">
                                <i class="fas fa-file-alt"></i>
                                File Changes
                            </button>
                            <button class="btn btn-outline" data-template="env-var">
                                <i class="fas fa-cog"></i>
                                Environment Variable
                            </button>
                            <button class="btn btn-outline" data-template="time-based">
                                <i class="fas fa-clock"></i>
                                Time Based
                            </button>
                        </div>
                    </div>
                    
                    <div class="condition-examples">
                        <h4>Common Patterns</h4>
                        <div class="example-grid">
                            <div class="example-item">
                                <h5>Production Deploy</h5>
                                <code>build.branch == "main" && build.tag != null</code>
                                <p>Only deploy tagged commits on main branch</p>
                            </div>
                            <div class="example-item">
                                <h5>Development Build</h5>
                                <code>build.branch != "main" && build.pull_request.id != null</code>
                                <p>Build feature branches in pull requests</p>
                            </div>
                            <div class="example-item">
                                <h5>Skip Drafts</h5>
                                <code>build.pull_request.draft != true</code>
                                <p>Skip steps for draft pull requests</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">Cancel</button>
                <button class="btn btn-primary" data-action="apply-conditions">Apply Conditions</button>
            </div>
        </div>
    </div>

    <!-- YAML Export Modal -->
    <div id="yaml-modal" class="modal hidden">
        <div class="modal-content large">
            <div class="modal-header">
                <h3><i class="fas fa-code"></i> Pipeline YAML</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="yaml-export">
                    <div class="yaml-actions">
                        <button id="copy-yaml" class="btn btn-secondary">
                            <i class="fas fa-copy"></i> Copy to Clipboard
                        </button>
                        <button id="download-yaml-modal" class="btn btn-secondary">
                            <i class="fas fa-download"></i> Download File
                        </button>
                        <button id="validate-yaml-modal" class="btn btn-secondary">
                            <i class="fas fa-check"></i> Validate
                        </button>
                        <button id="format-yaml" class="btn btn-secondary">
                            <i class="fas fa-align-left"></i> Format
                        </button>
                    </div>
                    <textarea id="yaml-output-modal" readonly placeholder="Your pipeline YAML will appear here..."></textarea>
                    <div id="yaml-validation-modal" class="validation-results hidden">
                        <h4>Validation Results</h4>
                        <div id="validation-content-modal"></div>
                    </div>
                    <div class="yaml-stats">
                        <div class="stat-item">
                            <span class="stat-label">Steps:</span>
                            <span class="stat-value" id="yaml-step-count">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Lines:</span>
                            <span class="stat-value" id="yaml-line-count">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Size:</span>
                            <span class="stat-value" id="yaml-size">0 bytes</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Keyboard Shortcuts Modal -->
    <div id="shortcuts-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-keyboard"></i> Keyboard Shortcuts</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="shortcuts-grid">
                    <div class="shortcut-category">
                        <h4>General</h4>
                        <div class="shortcut-item">
                            <kbd>Ctrl</kbd> + <kbd>K</kbd>
                            <span>Command Palette</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl</kbd> + <kbd>S</kbd>
                            <span>Export YAML</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl</kbd> + <kbd>E</kbd>
                            <span>Load Example</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl</kbd> + <kbd>N</kbd>
                            <span>Add Command Step</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>?</kbd>
                            <span>Show Shortcuts</span>
                        </div>
                    </div>
                    <div class="shortcut-category">
                        <h4>Pipeline</h4>
                        <div class="shortcut-item">
                            <kbd>Ctrl</kbd> + <kbd>P</kbd>
                            <span>Plugin Catalog</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl</kbd> + <kbd>M</kbd>
                            <span>Matrix Builder</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl</kbd> + <kbd>T</kbd>
                            <span>Step Templates</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl</kbd> + <kbd>G</kbd>
                            <span>Dependency Graph</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Delete</kbd>
                            <span>Remove Selected Step</span>
                        </div>
                    </div>
                    <div class="shortcut-category">
                        <h4>Navigation</h4>
                        <div class="shortcut-item">
                            <kbd>↑</kbd> <kbd>↓</kbd>
                            <span>Navigate Steps</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Tab</kbd>
                            <span>Next Property</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Enter</kbd>
                            <span>Edit Selected</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Escape</kbd>
                            <span>Cancel/Close</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- FIXED: Scripts loaded in proper order -->
    
    <!-- 1. Base dependencies first -->
    <script src="js/yaml-generator.js"></script>
    <script src="js/pipeline-patterns.js"></script>
    
    <!-- 2. Core pipeline builder class -->
    <script src="js/pipeline-builder.js"></script>
    
    <!-- 3. Enhanced classes that depend on base classes -->
    <script src="js/enhanced-pipeline-builder.js"></script>
    <script src="js/dependency-graph.js"></script>
    
    <!-- 4. Firebase auth (disabled) -->
    <script src="js/firebase-auth.js"></script>
    
    <!-- 5. Main initialization coordinator - LOADS LAST -->
    <script src="js/main-init.js"></script>
    
    <!-- 6. App-specific UI handlers - LOADS AFTER MAIN INIT -->
    <script src="js/app.js"></script>
</body>
</html>